# Use native zsh PATH deduplication (faster than awk)
typeset -U path

# Start with system path
is-executable getconf && PATH=$($(command -v getconf) PATH)

# Prepend new items to path (if directory exists)
prepend-path "$DOTFILES_DIR/bin"
prepend-path "/bin"
prepend-path "/usr/bin"
prepend-path "/sbin"
prepend-path "/usr/local/bin"
prepend-path "/usr/local/sbin"
prepend-path "/usr/sbin"
prepend-path "$HOME/bin"
prepend-path "$HOME/.local/bin"

case $(uname) in
Darwin)
  # macOS paths - use dynamic brew prefix
  BREW_PREFIX="$(get-brew-prefix 2>/dev/null || echo '/opt/homebrew')"
  prepend-path "${BREW_PREFIX}/bin"
  prepend-path "${BREW_PREFIX}/sbin"
  prepend-path "${BREW_PREFIX}/opt/ruby/bin"
  prepend-path "/Library/TeX/texbin"
  # Conda paths handled by lazy init in .zshrc
  ;;
Linux)
  prepend-path "/snap/bin"
  # Conda paths handled by lazy init in .zshrc
  ;;
esac

# Wrap up
export PATH

# Quarto - lazy evaluation
export QUARTO_PYTHON="${QUARTO_PYTHON:-$(command -v python 2>/dev/null)}"
